@page "/game"
@using Welp.ServerData;
@using Newtonsoft.Json;
@using Welp.ServerLogic;

<PageTitle>Welp-Admin</PageTitle>
<div class="row">
    <div class="col">
        <img class="game-board" src="images/game-board-2.png" alt="..." />
        <div>
            <div class="room x-2 y2">
                <BSRow Justify="Justify.Center">

                    @foreach (var player in State.Players.Where(p => p.Position == (-2, 2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x-1 y2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-1, 2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x0 y2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (0, 2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x1 y2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (1, 2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x2 y2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (2, 2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
        </div>

        <div>
            <div class="room x-2 y1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-2, 1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x-1 y1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-1, 1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x0 y1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (0, 1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x1 y1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (1, 1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x2 y1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (2, 1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
        </div>

        <div>
            <div class="room x-2 y0">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-2, 0)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x-1 y0">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-1, 0)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x0 y0">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (0, 0)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x1 y0">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (1, 0)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x2 y0">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (2, 0)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
        </div>

        <div>
            <div class="room x-2 y-1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-2, -1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x-1 y-1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-1, -1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x0 y-1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (0, -1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x1 y-1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (1, -1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x2 y-1">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (2, -1)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
        </div>

        <div>
            <div class="room x-2 y-2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-2, -2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x-1 y-2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (-1, -2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x0 y-2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (0, -2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x1 y-2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (1, -2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
            <div class="room x2 y-2">
                <BSRow Justify="Justify.Center">
                    @foreach (var player in State.Players.Where(p => p.Position == (2, -2)))
                    {
                        <div class="piece" id="@("character-"+player.Character.ToString())"></div>
                    }
                </BSRow>
            </div>
        </div>

    </div>
    <div class="col">
        <BSRow>
            <BSCol>
                <BSAccordion class="pt-5 pe-5">
                    @if (IAmScarlett)
                    {
                        <BSAccordionItem>
                            <Header>
                                <strong>
                                    Host Actions
                                </strong>
                            </Header>
                            <Content>
                                <BSRow Justify="Justify.Center">
                  <p class="lead">
                    You are the host, would you like to start/reset the game?
                  </p>
                  @if(State.Players.Count == 0 ){
                    <button @onclick="RestartGame" type="button" class="btn btn-success massive-button"
                    style="width: 300px">Start
                  </button>
                  }
                  
                  <button @onclick="RestartGame" type="button" class="btn btn-warning massive-button ms-2"
                    style="width: 300px">Restart
                  </button>
                  <button @onclick="TerminateGame" type="button" class="btn btn-danger massive-button ms-2"
                    style="width: 300px">Terminate
                  </button>
                                </BSRow>
                            </Content>
                        </BSAccordionItem>
                    }
                    <BSAccordionItem DefaultShown="IsPlayerTurn">
                        <Header>
                            <strong>
                                Player Actions
                            </strong>
                        </Header>
                        <Content>
                            @if (!IsPlayerTurn || CurrentOptions.EndTurn == null)
                            {
                                <BSRow Justify="Justify.Center">
                                    <p class="lead">
                                        Please wait for your turn.
                                    </p>
                                </BSRow>
                            }
                            else
                            {
                                <BSNav IsTabs="true">
                                    <BSNavItem>
                                        <TabLabel>Movement</TabLabel>
                                        <TabContent>
                                            <p class="lead pt-3">
                                                If you would like to move, make a selection and submit.
                                            </p>

                                            @if(MovementIndex is null)
                                            {
                                                <p>
                                                    Nothing Selected
                                                </p>
                                            }
                                            
                                            
                                            @foreach(var action in CurrentOptions?.Movement?.Select((m,i) => new {m,i}))
                                            {
                                                
                                                <div Class="@BS.Form_Check">
                                                    <BSInputRadio TValue="int?" CheckedValue="action.i" @bind-Value="MovementIndex" />
                                                    <BSLabel IsCheckLabel="true">Move to (@action.m.Details.NewPosition.Item1, @action.m.Details.NewPosition.Item2)</BSLabel>
                                                </div> 
                                            }
                                            <BSRow Justify="Justify.Center">
                                                <button @onclick="SubmitPlayerAction" disabled="@(MovementIndex is null ? true : false)" type="button"
                                                    class="btn btn-primary massive-button" style="width: 300px">
                                                    Send Movement
                                                </button>                                                
                                            </BSRow>
                                        </TabContent>    
                                    </BSNavItem>
                                    <BSNavItem>
                                        <TabLabel>Suggestion</TabLabel>
                                        <TabContent>
                                            <p class="lead pt-3">
                                                If you would like to make a suggestion, make a selection and submit.
                                            </p>

                                            @if(SuggestionWeapon <0 || SuggestionCharacter < 0)
                                            {
                                                <p>
                                                    Must Select Both a Weapon and Character
                                                </p>
                                                
                                            }

                                            <BSInput TValue="int" InputType="BlazorStrap.InputType.Select" @bind-Value="SuggestionWeapon" >                                            
                                                <option value="-1">Select a Weapon</option>
                                                <option value="0">@Weapon.Knife.ToString()</option>
                                                <option value="1">@Weapon.CandleStick.ToString()</option>
                                                <option value="2">@Weapon.Revolver.ToString()</option>
                                                <option value="3">@Weapon.Rope.ToString()</option>
                                                <option value="4">@Weapon.LeadPipe.ToString()</option>
                                                <option value="5">@Weapon.Wrench.ToString()</option>
                                            </BSInput>
                                        
                                            <BSInput class="mt-3" TValue="int" InputType="BlazorStrap.InputType.Select" @bind-Value="SuggestionCharacter" >                                            
                                                <option value="-1">Select a Character</option>
                                                <option value="0">@Character.MissScarlet.ToString()</option>
                                                <option value="1">@Character.ProfessorPlum.ToString()</option>
                                                <option value="2">@Character.ColonelMustard.ToString()</option>
                                                <option value="3">@Character.MrsPeacock.ToString()</option>
                                                <option value="4">@Character.MrGreen.ToString()</option>
                                                <option value="5">@Character.MrsWhite.ToString()</option>
                                            </BSInput>
                                            
                                            <BSRow Justify="Justify.Center">
                                                <button @onclick="SubmitSuggestion" disabled="@(SuggestionWeapon <0 || SuggestionCharacter <0)" type="button"
                                                    class="btn btn-primary massive-button" style="width: 300px">
                                                    Submit Suggestion
                                                </button>
                                            </BSRow>
                                        </TabContent>
                                        </BSNavItem>
                                    <BSNavItem>
                                        <TabLabel>Accusation</TabLabel>
                                        <TabContent>
                                            <p class="lead pt-3">
                                                If you would like to make a suggestion, make a selection and submit.
                                            </p>
                                            
                                            @if(AccusationWeapon <0  || AccusationCharacter <0 || AccusationRoomName <0)
                                            {
                                                <p>
                                                    Must Select a Weapon, Character, and Room
                                                </p>
                                                
                                            }
                                            
                                            <BSInput TValue="int" InputType="BlazorStrap.InputType.Select" @bind-Value="AccusationWeapon" >                                            
                                                <option value="-1">Select a Weapon</option>
                                                <option value="0">@Weapon.Knife.ToString()</option>
                                                <option value="1">@Weapon.CandleStick.ToString()</option>
                                                <option value="2">@Weapon.Revolver.ToString()</option>
                                                <option value="3">@Weapon.Rope.ToString()</option>
                                                <option value="4">@Weapon.LeadPipe.ToString()</option>
                                                <option value="5">@Weapon.Wrench.ToString()</option>
                                            </BSInput>
                                        
                                            <BSInput class="mt-3" TValue="int" InputType="BlazorStrap.InputType.Select" @bind-Value="AccusationCharacter" >                                            
                                                <option value="-1">Select a Character</option>
                                                <option value="0">@Character.MissScarlet.ToString()</option>
                                                <option value="1">@Character.ProfessorPlum.ToString()</option>
                                                <option value="2">@Character.ColonelMustard.ToString()</option>
                                                <option value="3">@Character.MrsPeacock.ToString()</option>
                                                <option value="4">@Character.MrGreen.ToString()</option>
                                                <option value="5">@Character.MrsWhite.ToString()</option>
                                            </BSInput>

                                            <BSInput class="mt-3" TValue="int" InputType="BlazorStrap.InputType.Select" @bind-Value="AccusationRoomName" >                                            
                                                <option value="-1">Select a Room</option>                                                
                                                <option value="0">@RoomName.Study.ToString()</option>
                                                <option value="1">@RoomName.Hall.ToString()</option>
                                                <option value="2">@RoomName.Lounge.ToString()</option>
                                                <option value="3">@RoomName.Library.ToString()</option>
                                                <option value="4">@RoomName.BilliardRoom.ToString()</option>
                                                <option value="5">@RoomName.DiningRoom.ToString()</option>
                                                <option value="6">@RoomName.Conservatory.ToString()</option>
                                                <option value="7">@RoomName.Ballroom.ToString()</option>
                                                <option value="8">@RoomName.Kitchen.ToString()</option>
                                                
                                            </BSInput>                                            
                                            
                                            <BSRow Justify="Justify.Center">
                                                <button @onclick="SubmitAccusation" type="button" disabled="@(AccusationWeapon <0 || AccusationCharacter <0 || AccusationRoomName <0)"
                                                    class="btn btn-primary massive-button" style="width: 300px">
                                                    Submit Accusation
                                                </button>
                                            </BSRow>
                                        </TabContent>
                                    </BSNavItem>
                                </BSNav>
                                <BSRow Justify="Justify.Start">

                                </BSRow>

                                
                                
                                <BSRow Justify="Justify.Center">
                                    <button @onclick="SubmitEndTurnAction" type="button"
                                        class="btn btn-warning massive-button" style="width: 300px">
                                        End Turn
                                    </button>
                                </BSRow>
                            }
                        </Content>
                    </BSAccordionItem>
                    <BSAccordionItem>
                        <Header><strong>Guess Sheet</strong></Header>
                        <Content>
                            <BSRow Justify="Justify.Center">
                                <div><strong>Suspects</strong></div>

                                @foreach (var (suspect, guesses) in Sheet.Suspects)
                                {
                                    <BSRow Justify="Justify.Center">
                                        <BSCol>@suspect</BSCol>
                                        @foreach (var bi in Enumerable.Range(0, guesses.Count))
                                        {
                                            <BSCol>
                                                <BSInputCheckbox TValue="bool" @bind-Value="Sheet.Suspects[suspect][bi]">
                                                </BSInputCheckbox>
                                            </BSCol>
                                        }
                                    </BSRow>
                                }
                            </BSRow>

                            <BSRow Justify="Justify.Center">
                                <div><strong>Rooms</strong></div>

                                @foreach (var (room, guesses) in Sheet.Rooms)
                                {
                                    <BSRow Justify="Justify.Center">
                                        <BSCol>@room</BSCol>
                                        @foreach (var bi in Enumerable.Range(0, guesses.Count))
                                        {
                                            <BSCol>
                                                <BSInputCheckbox TValue="bool" @bind-Value="Sheet.Rooms[room][bi]">
                                                </BSInputCheckbox>
                                            </BSCol>
                                        }
                                    </BSRow>
                                }
                            </BSRow>

                            <BSRow Justify="Justify.Center">
                                <div><strong>Weapons</strong></div>

                                @foreach (var (weapons, guesses) in Sheet.Weapons)
                                {
                                    <BSRow Justify="Justify.Center">
                                        <BSCol>@weapons</BSCol>
                                        @foreach (var bi in Enumerable.Range(0, guesses.Count))
                                        {
                                            <BSCol>
                                                <BSInputCheckbox TValue="bool" @bind-Value="Sheet.Weapons[weapons][bi]">
                                                </BSInputCheckbox>
                                            </BSCol>
                                        }
                                    </BSRow>
                                }
                            </BSRow>

                        </Content>
                    </BSAccordionItem>

                </BSAccordion>
            </BSCol>
        </BSRow>
    </div>
</div>